# Gemini Chat CLI (gchat)

**ç‰ˆæœ¬**: v3.0.0
**æ—¥æœŸ**: 2025-12-22
**ä½œè€…**: Claude Code & Mason

å¤šåŠŸèƒ½Geminiå¯¹è¯å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒäº¤äº’å¼å¯¹è¯ã€å•æ¬¡æé—®ã€ä¼šè¯ç®¡ç†ã€**Function Calling** ç­‰åŠŸèƒ½ã€‚

## ğŸ†• v3.0.0 æ–°åŠŸèƒ½ï¼šæ··åˆæ¨¡å¼ & Function Calling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              gchat æ··åˆæ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  æ™®é€šå¯¹è¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ é€†å‘API (å…è´¹æ— é™)          â”‚
â”‚      90%è¯·æ±‚              gemini_webapi            â”‚
â”‚                                                    â”‚
â”‚  Function Calling â”€â”€â”€â†’ å®˜æ–¹API (æœ‰é¢åº¦)           â”‚
â”‚      10%è¯·æ±‚              google-genai             â”‚
â”‚                                                    â”‚
â”‚  ğŸ’¡ å¯ç”¨å·¥å…·åè‡ªåŠ¨åˆ‡æ¢åˆ°å®˜æ–¹API                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# å¤åˆ¶è„šæœ¬åˆ°ç”¨æˆ·binç›®å½•
cp bin/gchat ~/bin/

# æˆ–åˆ›å»ºè½¯é“¾æ¥
ln -s $(pwd)/bin/gchat ~/bin/gchat

# ç¡®ä¿æœ‰æ‰§è¡Œæƒé™
chmod +x ~/bin/gchat

# æµ‹è¯•å®‰è£…
gchat --help
```

### åŸºæœ¬ä½¿ç”¨

```bash
# äº¤äº’å¼å¯¹è¯ï¼ˆæ–°å¯¹è¯ï¼‰
gchat

# ç»§ç»­ä¸Šæ¬¡å¯¹è¯
gchat -c

# å•æ¬¡æé—®
gchat -p "1+1=?"

# ä½¿ç”¨Proæ¨¡å‹
gchat -m pro
```

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. äº¤äº’å¼å¯¹è¯

```bash
$ gchat
You> ä½ å¥½
AI> ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ

You> /help        # æŸ¥çœ‹å¸®åŠ©
You> /history     # æŸ¥çœ‹å†å²
You> /clear       # æ¸…ç©ºä¸Šä¸‹æ–‡
You> /paste       # å¤šè¡Œè¾“å…¥æ¡†ï¼ˆCtrl+S å‘é€ï¼ŒCtrl+G/Ctrl+C å–æ¶ˆï¼‰
You> /mode box     # åˆ‡åˆ°è¾“å…¥æ¡†æ¨¡å¼ï¼ˆæ›´é€‚åˆé•¿æ–‡æœ¬/ç²˜è´´ï¼‰
You> /img ~/a.png # å‘é€å›¾ç‰‡ï¼ˆä¹Ÿæ”¯æŒç›´æ¥æ‹–æ‹½å›¾ç‰‡åˆ°ç»ˆç«¯è¾“å…¥ï¼‰
You> /quit        # é€€å‡ºï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
```

### 2. ä¼šè¯ç®¡ç†

```bash
# å¼€å¯æ–°å¯¹è¯
$ gchat

# ç»§ç»­ä¸Šæ¬¡å¯¹è¯ï¼ˆè‡ªåŠ¨åŠ è½½æœ€è¿‘çš„ä¼šè¯ï¼‰
$ gchat -c
ğŸ“‚ å·²åŠ è½½ä¼šè¯: gchat_history_20251219_120000.json
   å…± 4 æ¡æ¶ˆæ¯ (2 è½®å¯¹è¯)

# æ‰‹åŠ¨åŠ è½½æŒ‡å®šä¼šè¯
You> /load gchat_history_20251219_120000.json
```

### 3. å•æ¬¡æé—®ï¼ˆCLIé›†æˆï¼‰

```bash
# å¿«é€Ÿæé—®
gchat -p "ä»€ä¹ˆæ˜¯Python?"

# åœ¨è„šæœ¬ä¸­ä½¿ç”¨
ANSWER=$(gchat -p "1+1=?")
echo $ANSWER

# æŒ‡å®šæ¨¡å‹
gchat -p "è§£é‡Šé‡å­è®¡ç®—" -m pro
```

### 4. ä¸Šä¸‹æ–‡ç®¡ç†

```bash
You> æˆ‘å–œæ¬¢è“è‰²
AI> è“è‰²æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„é¢œè‰²...

You> /clear
ğŸ—‘ï¸  å·²æ¸…ç©º 2 æ¡æ¶ˆæ¯ (1 è½®å¯¹è¯)
   ä¸Šä¸‹æ–‡å·²é‡ç½®ï¼Œå¼€å§‹æ–°çš„å¯¹è¯

You> æˆ‘å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ
AI> æˆ‘æ²¡æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘å—ï¼Ÿ
```

---

## ğŸ“‹ å‘½ä»¤å‚è€ƒ

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `-p, --prompt` | å•æ¬¡æé—® | `gchat -p "é—®é¢˜"` |
| `-c, --continue` | ç»§ç»­ä¸Šæ¬¡ä¼šè¯ | `gchat -c` |
| `-m, --model` | æŒ‡å®šæ¨¡å‹ | `gchat -m pro` |
| `-b, --backend` | æŒ‡å®šåç«¯ | `gchat -b nexus` |
| `--list-models` | åˆ—å‡ºå¯ç”¨æ¨¡å‹ | `gchat --list-models` |

### äº¤äº’å¼å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/help, /h` | æ˜¾ç¤ºå¸®åŠ© |
| `/quit, /q` | é€€å‡ºå¹¶è‡ªåŠ¨ä¿å­˜ |
| `/clear, /c` | æ¸…ç©ºå¯¹è¯å†å² |
| `/history` | æ˜¾ç¤ºå¯¹è¯å†å² |
| `/model <name>` | åˆ‡æ¢æ¨¡å‹ |
| `/backend <name>` | åˆ‡æ¢åç«¯ |
| `/status` | æ˜¾ç¤ºå½“å‰çŠ¶æ€ |
| `/save <file>` | æ‰‹åŠ¨ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ |
| `/load <file>` | ä»æ–‡ä»¶åŠ è½½å¯¹è¯ |
| `/paste` | è¿›å…¥å¤šè¡Œè¾“å…¥æ¡†ï¼ˆCtrl+S å‘é€ï¼ŒCtrl+G/Ctrl+C å–æ¶ˆï¼‰ |
| `/mode [normal|box]` | åˆ‡æ¢è¾“å…¥æ¨¡å¼ï¼ˆbox æ¨¡å¼ä¼šç”¨ `[å†…å®¹]` æ¡†é¢„è§ˆç¡®è®¤ï¼‰ |
| `/img <path..> [text]` | å‘é€å›¾ç‰‡ï¼ˆä¹Ÿæ”¯æŒæ‹–æ‹½å›¾ç‰‡è·¯å¾„ï¼‰ |

---

## ğŸ¨ å¯ç”¨æ¨¡å‹

| åˆ«å | å®é™…æ¨¡å‹ | é€‚ç”¨åœºæ™¯ | é€Ÿåº¦ |
|------|---------|---------|------|
| `flash` â­ | gemini-3-flash-preview | æ—¥å¸¸å¯¹è¯ã€å¿«é€Ÿå“åº” | 2-5ç§’ |
| `flash2` | gemini-2.5-flash | æ—§ç‰ˆFlash | 2-5ç§’ |
| `pro` | gemini-2.5-pro | å¤æ‚æ¨ç†ã€ä»£ç ç”Ÿæˆ | 5-10ç§’ |
| `pro3` | gemini-3.0-pro | æœ€æ–°Proæ¨¡å‹ | 5-10ç§’ |

---

## ğŸ”§ åç«¯é…ç½®

### é»˜è®¤åç«¯ï¼šNexusAI

```python
BACKENDS = {
    "nexus": {
        "url": "https://nexusai.aihang365.com/v1/chat/completions",
        "key": "YOUR_API_KEY_HERE",  # éœ€è¦é…ç½®å®é™…key
        "name": "NexusAI",
    },
}
```

### æœ¬åœ°åç«¯ï¼ˆç¾å›½æœåŠ¡å™¨ï¼‰

```python
BACKENDS = {
    "local": {
        "url": "http://82.29.54.80:8100/v1/chat/completions",
        "name": "Gemini Reverse API (æœ¬åœ°)",
    },
}
```

### Function Calling æ”¯æŒæƒ…å†µ

| åç«¯ | Function Calling | å¤‡æ³¨ |
|------|------------------|------|
| NexusAI | âŒ ä¸æ”¯æŒ | ä»…æ”¯æŒåŸºæœ¬å¯¹è¯ |
| æœ¬åœ° (82.29.54.80) | âŒ ä¸æ”¯æŒ | ä»…æ”¯æŒåŸºæœ¬å¯¹è¯ |
| **YunWu AI** | âœ… æ”¯æŒ | å¯ç”¨äºå®ç° bash æ‰§è¡Œç­‰é«˜çº§åŠŸèƒ½ |

**YunWu AI é…ç½®**:
```python
"yunwu": {
    "url": "https://yunwu.ai/v1/chat/completions",
    "key": "sk-xxx",
    "name": "YunWu AI",
}
```

> **æ³¨æ„**: å¦‚éœ€æ·»åŠ  bash å‘½ä»¤æ‰§è¡Œç­‰åŠŸèƒ½ï¼Œéœ€ä½¿ç”¨æ”¯æŒ Function Calling çš„åç«¯ï¼ˆå¦‚ YunWu AIï¼‰ã€‚

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ—¥å¸¸å­¦ä¹ 

```bash
# æ—©ä¸Šå­¦ä¹ é‡å­è®¡ç®—
$ cd ~/learning/quantum
$ gchat
You> è§£é‡Šé‡å­çº ç¼ 
AI> é‡å­çº ç¼ æ˜¯...
You> /quit

# ä¸‹åˆç»§ç»­è®¨è®º
$ gchat -c
You> èƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ
```

### åœºæ™¯2ï¼šç¼–ç¨‹åŠ©æ‰‹

```bash
# å¿«é€Ÿè·å–ä»£ç å»ºè®®
$ gchat -p "Pythonå¦‚ä½•è¯»å–CSVæ–‡ä»¶?"

# è§£é‡Šä»£ç 
$ gchat -p "è§£é‡Šè¿™æ®µä»£ç : $(cat main.py)"

# è°ƒè¯•å¸®åŠ©
You> æˆ‘çš„ä»£ç æŠ¥é”™äº†ï¼šKeyError: 'name'
AI> è¿™ä¸ªé”™è¯¯è¡¨ç¤º...
```

### åœºæ™¯3ï¼šè„šæœ¬é›†æˆ

**Shellè„šæœ¬**:
```bash
#!/bin/bash
# è‡ªåŠ¨ç”Ÿæˆcommit message
diff=$(git diff --staged)
message=$(gchat -p "ä¸ºè¿™äº›æ”¹åŠ¨ç”Ÿæˆcommit message: $diff")
git commit -m "$message"
```

**Python**:
```python
import subprocess

def ai_review(code):
    result = subprocess.run(
        ['gchat', '-p', f'ä»£ç å®¡æŸ¥: {code}'],
        capture_output=True, text=True
    )
    return result.stdout

review = ai_review(open('main.py').read())
print(review)
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
gchat-cli/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ gchat                    # ä¸»ç¨‹åºè„šæœ¬
â””â”€â”€ docs/
    â”œâ”€â”€ GCHAT-CLI-USAGE.md      # CLIé›†æˆä½¿ç”¨æŒ‡å—
    â””â”€â”€ GCHAT-FIX.md            # ä¿®å¤è®°å½•å’ŒæŠ€æœ¯æ–‡æ¡£
```

---

## ğŸ” ç‰¹æ€§è¯¦è§£

### è‡ªåŠ¨ä¿å­˜ä¼šè¯

é€€å‡ºæ—¶è‡ªåŠ¨ä¿å­˜åˆ°å½“å‰ç›®å½•ï¼š

```
ğŸ’¾ ä¼šè¯å·²è‡ªåŠ¨ä¿å­˜åˆ°: gchat_history_20251219_120000.json
```

æ–‡ä»¶æ ¼å¼ï¼š
```json
{
  "model": "gemini-3-flash-preview",
  "messages": [
    {"role": "user", "content": "hello"},
    {"role": "assistant", "content": "Hi there!"}
  ],
  "timestamp": "20251219_120000"
}
```

### æ™ºèƒ½ä¼šè¯æ¢å¤

`gchat -c` è‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½æœ€è¿‘çš„ä¼šè¯ï¼š

```bash
$ gchat -c
ğŸ“‚ å·²åŠ è½½ä¼šè¯: gchat_history_20251219_120000.json
   å…± 4 æ¡æ¶ˆæ¯ (2 è½®å¯¹è¯)
ä¼šè¯: ç»§ç»­ä¸Šæ¬¡å¯¹è¯
```

### æ¸…ç©ºä¸Šä¸‹æ–‡

ä½¿ç”¨ `/clear` é‡ç½®å¯¹è¯ï¼š

```
You> /clear
ğŸ—‘ï¸  å·²æ¸…ç©º 4 æ¡æ¶ˆæ¯ (2 è½®å¯¹è¯)
   ä¸Šä¸‹æ–‡å·²é‡ç½®ï¼Œå¼€å§‹æ–°çš„å¯¹è¯
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šAPIé”™è¯¯

**ç°è±¡**: `[APIé”™è¯¯]: bad_response_status_code`

**è§£å†³**:
1. æ£€æŸ¥ `bin/gchat` ä¸­çš„BACKENDSé…ç½®
2. ç¡®è®¤API keyæ˜¯å¦æœ‰æ•ˆ
3. å°è¯•åˆ‡æ¢åç«¯ï¼š`gchat -b local`

### é—®é¢˜2ï¼šå‘½ä»¤not found

**ç°è±¡**: `gchat: command not found`

**è§£å†³**:
```bash
# æ£€æŸ¥PATH
echo $PATH | grep "$HOME/bin"

# æ·»åŠ åˆ°PATH
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

### é—®é¢˜3ï¼šè¿æ¥é”™è¯¯

**ç°è±¡**: `[è¿æ¥é”™è¯¯]: Connection reset by peer`

**åŸå› **: Python urllib/requestsä¸æŸäº›æœåŠ¡ä¸å…¼å®¹

**è§£å†³**: gchatå·²ä½¿ç”¨curlä½œä¸ºHTTPå®¢æˆ·ç«¯ï¼Œåº”è¯¥ä¸ä¼šå‡ºç°æ­¤é—®é¢˜

---

## ğŸ“š æŠ€æœ¯å®ç°

### HTTPå®¢æˆ·ç«¯ï¼šcurl

ä½¿ç”¨ `subprocess` è°ƒç”¨ `curl`ï¼Œå…¼å®¹æ€§æœ€å¥½ï¼š

```python
def chat_request(messages, model, backend_config):
    """å‘é€èŠå¤©è¯·æ±‚ï¼ˆä½¿ç”¨curlï¼‰"""
    curl_cmd = [
        'curl', '-s', '-X', 'POST', url,
        '-H', 'Content-Type: application/json',
        '-H', f'Authorization: Bearer {api_key}',
        '-d', json.dumps(payload)
    ]
    result = subprocess.run(curl_cmd, capture_output=True)
    return parse_response(result.stdout)
```

**ä¼˜åŠ¿**:
- âœ… å…¼å®¹æ‰€æœ‰APIæœåŠ¡
- âœ… é¿å…Python HTTPåº“çš„å…¼å®¹æ€§é—®é¢˜
- âœ… ç¨³å®šå¯é 

### ä¼šè¯ç®¡ç†

ä½¿ç”¨JSONæ–‡ä»¶å­˜å‚¨ä¼šè¯ï¼ŒæŒ‰æ—¶é—´æˆ³å‘½åï¼š

```python
def auto_save_history(messages, model):
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"gchat_history_{timestamp}.json"
    save_to_file(filename, {"model": model, "messages": messages})
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **CLIé›†æˆæŒ‡å—**: [docs/GCHAT-CLI-USAGE.md](docs/GCHAT-CLI-USAGE.md)
- **ä¿®å¤è®°å½•**: [docs/GCHAT-FIX.md](docs/GCHAT-FIX.md)
- **NexusAI APIæ–‡æ¡£**: `../zhongzhuan-api/docs/zhongzhuan_API.md`

---

## ğŸ¯ å¼€å‘è·¯çº¿å›¾

- [x] äº¤äº’å¼å¯¹è¯
- [x] å•æ¬¡æé—®æ¨¡å¼
- [x] è‡ªåŠ¨ä¿å­˜ä¼šè¯
- [x] ç»§ç»­ä¸Šæ¬¡å¯¹è¯
- [x] æ¸…ç©ºä¸Šä¸‹æ–‡
- [x] å¤šæ¨¡å‹æ”¯æŒ
- [x] å¤šåç«¯æ”¯æŒ
- [ ] æµå¼è¾“å‡ºï¼ˆå®æ—¶æ˜¾ç¤ºå›å¤ï¼‰
- [ ] ä¼šè¯æœç´¢åŠŸèƒ½
- [ ] å¯¼å‡ºä¸ºMarkdown
- [ ] æ”¯æŒå›¾ç‰‡è¾“å…¥

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

---

## ğŸ‘¥ ä½œè€…

- **Claude Code** - AIåŠ©æ‰‹
- **Mason** - é¡¹ç›®ç»´æŠ¤è€…

---

**æœ€åæ›´æ–°**: 2025-12-19
**ç‰ˆæœ¬**: v2.0.0
